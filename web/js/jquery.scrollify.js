!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],function(o){return t(o,e,e.document)}):"object"==typeof module&&module.exports?module.exports=t(require("jquery"),e,e.document):t(jQuery,e,e.document)}("undefined"!=typeof window?window:this,function(e,t,o,n){"use strict";function r(){return b.height()+R.offset}function i(o,n,i,s){if(w===o&&(i=!1),D===!0)return!0;if(m[o]){if(M=!1,k===!0&&(R.afterRender(),k=!1),i&&"function"==typeof R.before&&R.before(o,g)===!1)return!0;if(S=1,O=p[o],k===!1&&w>o&&s===!1&&v[o]&&(l=r(),S=parseInt(g[o].outerHeight()/l),O=parseInt(p[o])+(g[o].outerHeight()-l)),R.updateHash&&R.sectionName&&(k!==!0||0!==o))if(history.pushState)try{history.replaceState(null,null,m[o])}catch(a){t.console&&console.warn("Scrollify warning: Page must be hosted to manipulate the hash value.")}else t.location.hash=m[o];if(w=o,n)e(R.target).stop().scrollTop(O),i&&R.after(o,g);else{if(x=!0,e().velocity?e(R.target).stop().velocity("scroll",{duration:R.scrollSpeed,easing:R.easing,offset:O,mobileHA:!1}):e(R.target).stop().animate({scrollTop:O},R.scrollSpeed,R.easing),t.location.hash.length&&R.sectionName&&t.console)try{e(t.location.hash).length&&console.warn("Scrollify warning: ID matches hash value - this will cause the page to anchor.")}catch(a){}e(R.target).promise().done(function(){x=!1,k=!1,i&&R.after(o,g)})}}}function s(e){function t(t){for(var o=0,n=e.slice(Math.max(e.length-t,1)),r=0;r<n.length;r++)o+=n[r];return Math.ceil(o/t)}var o=t(10),n=t(70);return o>=n}function a(e,t){for(var o=m.length;o>=0;o--)"string"==typeof e?m[o]===e&&(y=o,i(o,t,!0,!0)):o===e&&(y=o,i(o,t,!0,!0))}var c,u,l,h,f,d,p=[],m=[],g=[],v=[],y=0,w=0,S=1,H=!1,b=e(t),E=b.scrollTop(),M=!1,x=!1,T=!1,D=!1,I=[],N=(new Date).getTime(),k=!0,L=!1,O=0,z="onwheel"in o?"wheel":o.onmousewheel!==n?"mousewheel":"DOMMouseScroll",R={section:".section",sectionName:"section-name",interstitialSection:"",easing:"easeOutExpo",scrollSpeed:1100,offset:0,scrollbars:!0,target:"html,body",standardScrollElements:!1,setHeights:!0,overflowScroll:!0,updateHash:!0,touchScroll:!0,before:function(){},after:function(){},afterResize:function(){},afterRender:function(){}},j=function(n){function a(t){e().velocity?e(R.target).stop().velocity("scroll",{duration:R.scrollSpeed,easing:R.easing,offset:t,mobileHA:!1}):e(R.target).stop().animate({scrollTop:t},R.scrollSpeed,R.easing)}function w(t){t&&(E=b.scrollTop());var o=R.section;v=[],R.interstitialSection.length&&(o+=","+R.interstitialSection),R.scrollbars===!1&&(R.overflowScroll=!1),l=r(),e(o).each(function(t){var o=e(this);R.setHeights?o.is(R.interstitialSection)?v[t]=!1:o.css("height","auto").outerHeight()<l||"hidden"===o.css("overflow")?(o.css({height:l}),v[t]=!1):(o.css({height:o.height()}),R.overflowScroll?v[t]=!0:v[t]=!1):o.outerHeight()<l||R.overflowScroll===!1?v[t]=!1:v[t]=!0}),t&&b.scrollTop(E)}function k(o,n){var r=R.section;R.interstitialSection.length&&(r+=","+R.interstitialSection),p=[],m=[],g=[],e(r).each(function(o){var n=e(this);o>0?p[o]=parseInt(n.offset().top)+R.offset:p[o]=parseInt(n.offset().top),R.sectionName&&n.data(R.sectionName)?m[o]="#"+n.data(R.sectionName).toString().replace(/ /g,"-"):n.is(R.interstitialSection)===!1?m[o]="#"+(o+1):(m[o]="#",o===e(r).length-1&&o>1&&(p[o]=p[o-1]+(parseInt(e(e(r)[o-1]).outerHeight())-parseInt(e(t).height()))+parseInt(n.outerHeight()))),g[o]=n;try{e(m[o]).length&&t.console&&console.warn("Scrollify warning: Section names can't match IDs - this will cause the browser to anchor.")}catch(i){}t.location.hash===m[o]&&(y=o,H=!0)}),!0===o&&i(y,!1,!1,!1)}function O(){return!v[y]||(E=b.scrollTop(),!(E>parseInt(p[y])))}function j(){return!v[y]||(E=b.scrollTop(),l=r(),!(E<parseInt(p[y])+(g[y].outerHeight()-l)-28))}L=!0,e.easing.easeOutExpo=function(e,t,o,n,r){return t==r?o+n:n*(-Math.pow(2,-10*t/r)+1)+o},h={handleMousedown:function(){return D===!0||(M=!1,void(T=!1))},handleMouseup:function(){return D===!0||(M=!0,void(T&&h.calculateNearest(!1,!0)))},handleScroll:function(){return D===!0||(c&&clearTimeout(c),void(c=setTimeout(function(){return T=!0,M!==!1&&(M=!1,void h.calculateNearest(!1,!0))},200)))},calculateNearest:function(e,t){E=b.scrollTop();for(var o,n=1,r=p.length,s=0,a=Math.abs(p[0]-E);n<r;n++)o=Math.abs(p[n]-E),o<a&&(a=o,s=n);(j()&&s>y||O())&&(y=s,i(s,e,t,!1))},wheelHandler:function(o){if(D===!0)return!0;if(R.standardScrollElements&&(e(o.target).is(R.standardScrollElements)||e(o.target).closest(R.standardScrollElements).length))return!0;v[y]||o.preventDefault();var n=(new Date).getTime();o=o||t.event;var r=o.originalEvent.wheelDelta||-o.originalEvent.deltaY||-o.originalEvent.detail,a=Math.max(-1,Math.min(1,r));if(I.length>149&&I.shift(),I.push(Math.abs(r)),n-N>200&&(I=[]),N=n,x)return!1;if(a<0){if(y<p.length-1&&j()){if(!s(I))return!1;o.preventDefault(),y++,x=!0,i(y,!1,!0,!1)}}else if(a>0&&y>0&&O()){if(!s(I))return!1;o.preventDefault(),y--,x=!0,i(y,!1,!0,!1)}},keyHandler:function(e){return D===!0||o.activeElement.readOnly===!1||x!==!0&&void(38==e.keyCode||33==e.keyCode?y>0&&O()&&(e.preventDefault(),y--,i(y,!1,!0,!1)):40!=e.keyCode&&34!=e.keyCode||y<p.length-1&&j()&&(e.preventDefault(),y++,i(y,!1,!0,!1)))},init:function(){R.scrollbars?(b.on("mousedown",h.handleMousedown),b.on("mouseup",h.handleMouseup),b.on("scroll",h.handleScroll)):e("body").css({overflow:"hidden"}),b.on(z,h.wheelHandler),b.on("keydown",h.keyHandler)}},f={touches:{touchstart:{y:-1,x:-1},touchmove:{y:-1,x:-1},touchend:!1,direction:"undetermined"},options:{distance:30,timeGap:800,timeStamp:(new Date).getTime()},touchHandler:function(t){if(D===!0)return!0;if(R.standardScrollElements&&(e(t.target).is(R.standardScrollElements)||e(t.target).closest(R.standardScrollElements).length))return!0;var o;if("undefined"!=typeof t&&"undefined"!=typeof t.touches)switch(o=t.touches[0],t.type){case"touchstart":f.touches.touchstart.y=o.pageY,f.touches.touchmove.y=-1,f.touches.touchstart.x=o.pageX,f.touches.touchmove.x=-1,f.options.timeStamp=(new Date).getTime(),f.touches.touchend=!1;case"touchmove":f.touches.touchmove.y=o.pageY,f.touches.touchmove.x=o.pageX,f.touches.touchstart.y!==f.touches.touchmove.y&&Math.abs(f.touches.touchstart.y-f.touches.touchmove.y)>Math.abs(f.touches.touchstart.x-f.touches.touchmove.x)&&(t.preventDefault(),f.touches.direction="y",f.options.timeStamp+f.options.timeGap<(new Date).getTime()&&0==f.touches.touchend&&(f.touches.touchend=!0,f.touches.touchstart.y>-1&&Math.abs(f.touches.touchmove.y-f.touches.touchstart.y)>f.options.distance&&(f.touches.touchstart.y<f.touches.touchmove.y?f.up():f.down())));break;case"touchend":f.touches[t.type]===!1&&(f.touches[t.type]=!0,f.touches.touchstart.y>-1&&f.touches.touchmove.y>-1&&"y"===f.touches.direction&&(Math.abs(f.touches.touchmove.y-f.touches.touchstart.y)>f.options.distance&&(f.touches.touchstart.y<f.touches.touchmove.y?f.up():f.down()),f.touches.touchstart.y=-1,f.touches.touchstart.x=-1,f.touches.direction="undetermined"))}},down:function(){y<p.length&&(j()&&y<p.length-1?(y++,i(y,!1,!0,!1)):(l=r(),Math.floor(g[y].height()/l)>S?(a(parseInt(p[y])+l*S),S+=1):a(parseInt(p[y])+(g[y].outerHeight()-l))))},up:function(){y>=0&&(O()&&y>0?(y--,i(y,!1,!0,!1)):S>2?(l=r(),S-=1,a(parseInt(p[y])+l*S)):(S=1,a(parseInt(p[y]))))},init:function(){if(o.addEventListener&&R.touchScroll){var e={passive:!1};o.addEventListener("touchstart",f.touchHandler,e),o.addEventListener("touchmove",f.touchHandler,e),o.addEventListener("touchend",f.touchHandler,e)}}},d={refresh:function(e,t){clearTimeout(u),u=setTimeout(function(){w(!0),k(t,!1),e&&R.afterResize()},400)},handleUpdate:function(){d.refresh(!1,!1)},handleResize:function(){d.refresh(!0,!1)},handleOrientation:function(){d.refresh(!0,!0)}},R=e.extend(R,n),w(!1),k(!1,!0),!0===H?i(y,!1,!0,!0):setTimeout(function(){h.calculateNearest(!0,!1)},200),p.length&&(h.init(),f.init(),b.on("resize",d.handleResize),o.addEventListener&&t.addEventListener("orientationchange",d.handleOrientation,!1))};return j.move=function(t){return t!==n&&(t.originalEvent&&(t=e(this).attr("href")),void a(t,!1))},j.instantMove=function(e){return e!==n&&void a(e,!0)},j.next=function(){y<m.length&&(y+=1,i(y,!1,!0,!0))},j.previous=function(){y>0&&(y-=1,i(y,!1,!0,!0))},j.instantNext=function(){y<m.length&&(y+=1,i(y,!0,!0,!0))},j.instantPrevious=function(){y>0&&(y-=1,i(y,!0,!0,!0))},j.destroy=function(){return!!L&&(R.setHeights&&e(R.section).each(function(){e(this).css("height","auto")}),b.off("resize",d.handleResize),R.scrollbars&&(b.off("mousedown",h.handleMousedown),b.off("mouseup",h.handleMouseup),b.off("scroll",h.handleScroll)),b.off(z,h.wheelHandler),b.off("keydown",h.keyHandler),o.addEventListener&&R.touchScroll&&(o.removeEventListener("touchstart",f.touchHandler,!1),o.removeEventListener("touchmove",f.touchHandler,!1),o.removeEventListener("touchend",f.touchHandler,!1)),p=[],m=[],g=[],void(v=[]))},j.update=function(){return!!L&&void d.handleUpdate()},j.current=function(){return g[y]},j.currentIndex=function(){return y},j.disable=function(){D=!0},j.enable=function(){D=!1,L&&h.calculateNearest(!1,!1)},j.isDisabled=function(){return D},j.setOptions=function(o){return!!L&&void("object"==typeof o?(R=e.extend(R,o),d.handleUpdate()):t.console&&console.warn("Scrollify warning: setOptions expects an object."))},e.scrollify=j,j});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zY3JvbGxpZnkuanMiXSwibmFtZXMiOlsiZ2xvYmFsIiwiZmFjdG9yeSIsImRlZmluZSIsImFtZCIsIiQiLCJkb2N1bWVudCIsIm1vZHVsZSIsImV4cG9ydHMiLCJyZXF1aXJlIiwialF1ZXJ5Iiwid2luZG93IiwidGhpcyIsInVuZGVmaW5lZCIsImdldHBvcnRIZWlnaHQiLCIkd2luZG93IiwiaGVpZ2h0Iiwic2V0dGluZ3MiLCJvZmZzZXQiLCJhbmltYXRlU2Nyb2xsIiwiaW5kZXgiLCJpbnN0YW50IiwiY2FsbGJhY2tzIiwidG9Ub3AiLCJjdXJyZW50SW5kZXgiLCJkaXNhYmxlZCIsIm5hbWVzIiwic2Nyb2xsYWJsZSIsImZpcnN0TG9hZCIsImFmdGVyUmVuZGVyIiwiYmVmb3JlIiwiZWxlbWVudHMiLCJpbnRlcnN0aXRpYWxJbmRleCIsImRlc3RpbmF0aW9uIiwiaGVpZ2h0cyIsIm92ZXJmbG93IiwicG9ydEhlaWdodCIsInBhcnNlSW50Iiwib3V0ZXJIZWlnaHQiLCJ1cGRhdGVIYXNoIiwic2VjdGlvbk5hbWUiLCJoaXN0b3J5IiwicHVzaFN0YXRlIiwicmVwbGFjZVN0YXRlIiwiZSIsImNvbnNvbGUiLCJ3YXJuIiwibG9jYXRpb24iLCJoYXNoIiwidGFyZ2V0Iiwic3RvcCIsInNjcm9sbFRvcCIsImFmdGVyIiwibG9ja2VkIiwidmVsb2NpdHkiLCJkdXJhdGlvbiIsInNjcm9sbFNwZWVkIiwiZWFzaW5nIiwibW9iaWxlSEEiLCJhbmltYXRlIiwibGVuZ3RoIiwicHJvbWlzZSIsImRvbmUiLCJpc0FjY2VsZXJhdGluZyIsInNhbXBsZXMiLCJhdmVyYWdlIiwibnVtIiwic3VtIiwibGFzdEVsZW1lbnRzIiwic2xpY2UiLCJNYXRoIiwibWF4IiwiaSIsImNlaWwiLCJhdkVuZCIsImF2TWlkZGxlIiwibW92ZSIsInBhbmVsIiwieiIsInRpbWVvdXRJZCIsInRpbWVvdXRJZDIiLCJtYW51YWxTY3JvbGwiLCJzd2lwZVNjcm9sbCIsInV0aWwiLCJoYXNMb2NhdGlvbiIsInRvcCIsInNjcm9sbGVkIiwic2Nyb2xsU2FtcGxlcyIsInNjcm9sbFRpbWUiLCJEYXRlIiwiZ2V0VGltZSIsImluaXRpYWxpc2VkIiwid2hlZWxFdmVudCIsIm9ubW91c2V3aGVlbCIsInNlY3Rpb24iLCJpbnRlcnN0aXRpYWxTZWN0aW9uIiwic2Nyb2xsYmFycyIsInN0YW5kYXJkU2Nyb2xsRWxlbWVudHMiLCJzZXRIZWlnaHRzIiwib3ZlcmZsb3dTY3JvbGwiLCJ0b3VjaFNjcm9sbCIsImFmdGVyUmVzaXplIiwic2Nyb2xsaWZ5Iiwib3B0aW9ucyIsImludGVyc3RpdGlhbFNjcm9sbCIsInBvcyIsInNpemVQYW5lbHMiLCJrZWVwUG9zaXRpb24iLCJzZWxlY3RvciIsImVhY2giLCIkdGhpcyIsImlzIiwiY3NzIiwiY2FsY3VsYXRlUG9zaXRpb25zIiwic2Nyb2xsIiwiZGF0YSIsInRvU3RyaW5nIiwicmVwbGFjZSIsImF0VG9wIiwiYXRCb3R0b20iLCJ4IiwidCIsImIiLCJjIiwiZCIsInBvdyIsImhhbmRsZU1vdXNlZG93biIsImhhbmRsZU1vdXNldXAiLCJjYWxjdWxhdGVOZWFyZXN0IiwiaGFuZGxlU2Nyb2xsIiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsImRpZmYiLCJjbG9zZXN0IiwicHJldiIsImFicyIsIndoZWVsSGFuZGxlciIsInByZXZlbnREZWZhdWx0IiwiY3VycmVudFNjcm9sbFRpbWUiLCJldmVudCIsInZhbHVlIiwib3JpZ2luYWxFdmVudCIsIndoZWVsRGVsdGEiLCJkZWx0YVkiLCJkZXRhaWwiLCJkZWx0YSIsIm1pbiIsInNoaWZ0IiwicHVzaCIsImtleUhhbmRsZXIiLCJhY3RpdmVFbGVtZW50IiwicmVhZE9ubHkiLCJrZXlDb2RlIiwiaW5pdCIsIm9uIiwidG91Y2hlcyIsInRvdWNoc3RhcnQiLCJ5IiwidG91Y2htb3ZlIiwidG91Y2hlbmQiLCJkaXJlY3Rpb24iLCJkaXN0YW5jZSIsInRpbWVHYXAiLCJ0aW1lU3RhbXAiLCJ0b3VjaEhhbmRsZXIiLCJ0b3VjaCIsInR5cGUiLCJwYWdlWSIsInBhZ2VYIiwidXAiLCJkb3duIiwiZmxvb3IiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnRMaXN0ZW5lck9wdGlvbnMiLCJwYXNzaXZlIiwicmVmcmVzaCIsIndpdGhDYWxsYmFjayIsImhhbmRsZVVwZGF0ZSIsImhhbmRsZVJlc2l6ZSIsImhhbmRsZU9yaWVudGF0aW9uIiwiZXh0ZW5kIiwiYXR0ciIsImluc3RhbnRNb3ZlIiwibmV4dCIsInByZXZpb3VzIiwiaW5zdGFudE5leHQiLCJpbnN0YW50UHJldmlvdXMiLCJkZXN0cm95Iiwib2ZmIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInVwZGF0ZSIsImN1cnJlbnQiLCJkaXNhYmxlIiwiZW5hYmxlIiwiaXNEaXNhYmxlZCIsInNldE9wdGlvbnMiLCJ1cGRhdGVkT3B0aW9ucyJdLCJtYXBwaW5ncyI6IkNBZ0NDLFNBQVVBLEVBQU9DLEdBQ2hCLFlBQ3NCLG1CQUFYQyxTQUF5QkEsT0FBT0MsSUFFekNELFFBQVEsVUFBVyxTQUFTRSxHQUMxQixNQUFPSCxHQUFRRyxFQUFHSixFQUFRQSxFQUFPSyxZQUVSLGdCQUFYQyxTQUF1QkEsT0FBT0MsUUFFOUNELE9BQU9DLFFBQVVOLEVBQVFPLFFBQVEsVUFBV1IsRUFBUUEsRUFBT0ssVUFHM0RKLEVBQVFRLE9BQVFULEVBQVFBLEVBQU9LLFdBRWYsbUJBQVhLLFFBQXlCQSxPQUFTQyxLQUFNLFNBQVVQLEVBQUdNLEVBQVFMLEVBQVVPLEdBQzlFLFlBK0NBLFNBQVNDLEtBQ1AsTUFBUUMsR0FBUUMsU0FBV0MsRUFBU0MsT0FFdEMsUUFBU0MsR0FBY0MsRUFBTUMsRUFBUUMsRUFBVUMsR0FJN0MsR0FIR0MsSUFBZUosSUFDaEJFLEdBQVksR0FFWEcsS0FBVyxFQUNaLE9BQU8sQ0FFVCxJQUFHQyxFQUFNTixHQUFRLENBTWYsR0FMQU8sR0FBYSxFQUNWQyxLQUFZLElBQ2JYLEVBQVNZLGNBQ1RELEdBQVksR0FFWE4sR0FDNkIsa0JBQW5CTCxHQUFTYSxRQUF3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QVUsV0FDbEJ2SyxHQUFXLEdBRWI2RSxFQUFVMkYsT0FBUyxXQUNqQnhLLEdBQVcsRUFDUGtFLEdBRUZWLEVBQWErQyxrQkFBaUIsR0FBTSxJQUd4QzFCLEVBQVU0RixXQUFhLFdBQ3JCLE1BQU96SyxJQUVUNkUsRUFBVTZGLFdBQWEsU0FBU0MsR0FDOUIsUUFBSXpHLFFBR3lCLGdCQUFuQnlHLElBQ1JuTCxFQUFXWixFQUFFK0ssT0FBT25LLEVBQVVtTCxHQUM5QmpILEVBQUs4RixnQkFDR3RLLEVBQU9rQyxTQUNmQSxRQUFRQyxLQUFLLHNEQUdqQnpDLEVBQUVpRyxVQUFZQSxFQUNQQSIsImZpbGUiOiJqcXVlcnkuc2Nyb2xsaWZ5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXHJcbiAqIGpRdWVyeSBTY3JvbGxpZnlcclxuICogVmVyc2lvbiAxLjAuMTlcclxuICpcclxuICogUmVxdWlyZXM6XHJcbiAqIC0galF1ZXJ5IDEuNyBvciBoaWdoZXJcclxuICpcclxuICogaHR0cHM6Ly9naXRodWIuY29tL2x1a2VoYWFzL1Njcm9sbGlmeVxyXG4gKlxyXG4gKiBDb3B5cmlnaHQgMjAxNiwgTHVrZSBIYWFzXHJcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkgb2ZcclxuICogdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbCBpblxyXG4gKiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvXHJcbiAqIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mXHJcbiAqIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbyxcclxuICogc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XHJcbiAqXHJcbiAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxyXG4gKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxyXG4gKlxyXG4gKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXHJcbiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTXHJcbiAqIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUlxyXG4gKiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVJcclxuICogSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU5cclxuICogQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS5cclxuXHJcblxyXG5cclxuaWYgdG91Y2hTY3JvbGwgaXMgZmFsc2UgLSB1cGRhdGUgaW5kZXhcclxuXHJcbiAqL1xyXG4oZnVuY3Rpb24gKGdsb2JhbCxmYWN0b3J5KSB7XHJcbiAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xyXG4gICAgLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlLlxyXG4gICAgZGVmaW5lKFsnanF1ZXJ5J10sIGZ1bmN0aW9uKCQpIHtcclxuICAgICAgcmV0dXJuIGZhY3RvcnkoJCwgZ2xvYmFsLCBnbG9iYWwuZG9jdW1lbnQpO1xyXG4gICAgfSk7XHJcbiAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cykge1xyXG4gICAgLy8gTm9kZS9Db21tb25KU1xyXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJ2pxdWVyeScpLCBnbG9iYWwsIGdsb2JhbC5kb2N1bWVudCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIC8vIEJyb3dzZXIgZ2xvYmFsc1xyXG4gICAgZmFjdG9yeShqUXVlcnksIGdsb2JhbCwgZ2xvYmFsLmRvY3VtZW50KTtcclxuICB9XHJcbn0odHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiB0aGlzLCBmdW5jdGlvbiAoJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7XHJcbiAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgdmFyIGhlaWdodHMgPSBbXSxcclxuICAgIG5hbWVzID0gW10sXHJcbiAgICBlbGVtZW50cyA9IFtdLFxyXG4gICAgb3ZlcmZsb3cgPSBbXSxcclxuICAgIGluZGV4ID0gMCxcclxuICAgIGN1cnJlbnRJbmRleCA9IDAsXHJcbiAgICBpbnRlcnN0aXRpYWxJbmRleCA9IDEsXHJcbiAgICBoYXNMb2NhdGlvbiA9IGZhbHNlLFxyXG4gICAgdGltZW91dElkLFxyXG4gICAgdGltZW91dElkMixcclxuICAgICR3aW5kb3cgPSAkKHdpbmRvdyksXHJcbiAgICBwb3J0SGVpZ2h0LFxyXG4gICAgdG9wID0gJHdpbmRvdy5zY3JvbGxUb3AoKSxcclxuICAgIHNjcm9sbGFibGUgPSBmYWxzZSxcclxuICAgIGxvY2tlZCA9IGZhbHNlLFxyXG4gICAgc2Nyb2xsZWQgPSBmYWxzZSxcclxuICAgIG1hbnVhbFNjcm9sbCxcclxuICAgIHN3aXBlU2Nyb2xsLFxyXG4gICAgdXRpbCxcclxuICAgIGRpc2FibGVkID0gZmFsc2UsXHJcbiAgICBzY3JvbGxTYW1wbGVzID0gW10sXHJcbiAgICBzY3JvbGxUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICBmaXJzdExvYWQgPSB0cnVlLFxyXG4gICAgaW5pdGlhbGlzZWQgPSBmYWxzZSxcclxuICAgIGRlc3RpbmF0aW9uID0gMCxcclxuICAgIHdoZWVsRXZlbnQgPSAnb253aGVlbCcgaW4gZG9jdW1lbnQgPyAnd2hlZWwnIDogZG9jdW1lbnQub25tb3VzZXdoZWVsICE9PSB1bmRlZmluZWQgPyAnbW91c2V3aGVlbCcgOiAnRE9NTW91c2VTY3JvbGwnLFxyXG4gICAgc2V0dGluZ3MgPSB7XHJcbiAgICAgIC8vc2VjdGlvbiBzaG91bGQgYmUgYW4gaWRlbnRpZmllciB0aGF0IGlzIHRoZSBzYW1lIGZvciBlYWNoIHNlY3Rpb25cclxuICAgICAgc2VjdGlvbjogXCIuc2VjdGlvblwiLFxyXG4gICAgICBzZWN0aW9uTmFtZTogXCJzZWN0aW9uLW5hbWVcIixcclxuICAgICAgaW50ZXJzdGl0aWFsU2VjdGlvbjogXCJcIixcclxuICAgICAgZWFzaW5nOiBcImVhc2VPdXRFeHBvXCIsXHJcbiAgICAgIHNjcm9sbFNwZWVkOiAxMTAwLFxyXG4gICAgICBvZmZzZXQ6IDAsXHJcbiAgICAgIHNjcm9sbGJhcnM6IHRydWUsXHJcbiAgICAgIHRhcmdldDpcImh0bWwsYm9keVwiLFxyXG4gICAgICBzdGFuZGFyZFNjcm9sbEVsZW1lbnRzOiBmYWxzZSxcclxuICAgICAgc2V0SGVpZ2h0czogdHJ1ZSxcclxuICAgICAgb3ZlcmZsb3dTY3JvbGw6dHJ1ZSxcclxuICAgICAgdXBkYXRlSGFzaDogdHJ1ZSxcclxuICAgICAgdG91Y2hTY3JvbGw6dHJ1ZSxcclxuICAgICAgYmVmb3JlOmZ1bmN0aW9uKCkge30sXHJcbiAgICAgIGFmdGVyOmZ1bmN0aW9uKCkge30sXHJcbiAgICAgIGFmdGVyUmVzaXplOmZ1bmN0aW9uKCkge30sXHJcbiAgICAgIGFmdGVyUmVuZGVyOmZ1bmN0aW9uKCkge31cclxuICAgIH07XHJcbiAgZnVuY3Rpb24gZ2V0cG9ydEhlaWdodCgpIHtcclxuICAgIHJldHVybiAoJHdpbmRvdy5oZWlnaHQoKSArIHNldHRpbmdzLm9mZnNldCk7XHJcbiAgfVxyXG4gIGZ1bmN0aW9uIGFuaW1hdGVTY3JvbGwoaW5kZXgsaW5zdGFudCxjYWxsYmFja3MsdG9Ub3ApIHtcclxuICAgIGlmKGN1cnJlbnRJbmRleD09PWluZGV4KSB7XHJcbiAgICAgIGNhbGxiYWNrcyA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYoZGlzYWJsZWQ9PT10cnVlKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYobmFtZXNbaW5kZXhdKSB7XHJcbiAgICAgIHNjcm9sbGFibGUgPSBmYWxzZTtcclxuICAgICAgaWYoZmlyc3RMb2FkPT09dHJ1ZSkge1xyXG4gICAgICAgIHNldHRpbmdzLmFmdGVyUmVuZGVyKCk7XHJcbiAgICAgICAgZmlyc3RMb2FkID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgaWYoY2FsbGJhY2tzKSB7XHJcbiAgICAgICAgaWYoIHR5cGVvZiBzZXR0aW5ncy5iZWZvcmUgPT0gJ2Z1bmN0aW9uJyAmJiBzZXR0aW5ncy5iZWZvcmUoaW5kZXgsZWxlbWVudHMpID09PSBmYWxzZSApe1xyXG4gICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGludGVyc3RpdGlhbEluZGV4ID0gMTtcclxuICAgICAgZGVzdGluYXRpb24gPSBoZWlnaHRzW2luZGV4XTtcclxuICAgICAgaWYoZmlyc3RMb2FkPT09ZmFsc2UgJiYgY3VycmVudEluZGV4PmluZGV4ICYmIHRvVG9wPT09ZmFsc2UpIHtcclxuICAgICAgICAvL1dlJ3JlIGdvaW5nIGJhY2t3YXJkc1xyXG4gICAgICAgIGlmKG92ZXJmbG93W2luZGV4XSkge1xyXG4gICAgICAgICAgcG9ydEhlaWdodCA9IGdldHBvcnRIZWlnaHQoKTtcclxuXHJcbiAgICAgICAgICBpbnRlcnN0aXRpYWxJbmRleCA9IHBhcnNlSW50KGVsZW1lbnRzW2luZGV4XS5vdXRlckhlaWdodCgpL3BvcnRIZWlnaHQpO1xyXG5cclxuICAgICAgICAgIGRlc3RpbmF0aW9uID0gcGFyc2VJbnQoaGVpZ2h0c1tpbmRleF0pKyhlbGVtZW50c1tpbmRleF0ub3V0ZXJIZWlnaHQoKS1wb3J0SGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcblxyXG4gICAgICBpZihzZXR0aW5ncy51cGRhdGVIYXNoICYmIHNldHRpbmdzLnNlY3Rpb25OYW1lICYmICEoZmlyc3RMb2FkPT09dHJ1ZSAmJiBpbmRleD09PTApKSB7XHJcbiAgICAgICAgaWYoaGlzdG9yeS5wdXNoU3RhdGUpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZShudWxsLCBudWxsLCBuYW1lc1tpbmRleF0pO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgaWYod2luZG93LmNvbnNvbGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIlNjcm9sbGlmeSB3YXJuaW5nOiBQYWdlIG11c3QgYmUgaG9zdGVkIHRvIG1hbmlwdWxhdGUgdGhlIGhhc2ggdmFsdWUuXCIpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBuYW1lc1tpbmRleF07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjdXJyZW50SW5kZXggPSBpbmRleDtcclxuICAgICAgaWYoaW5zdGFudCkge1xyXG4gICAgICAgICQoc2V0dGluZ3MudGFyZ2V0KS5zdG9wKCkuc2Nyb2xsVG9wKGRlc3RpbmF0aW9uKTtcclxuICAgICAgICBpZihjYWxsYmFja3MpIHtcclxuICAgICAgICAgIHNldHRpbmdzLmFmdGVyKGluZGV4LGVsZW1lbnRzKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbG9ja2VkID0gdHJ1ZTtcclxuICAgICAgICBpZiggJCgpLnZlbG9jaXR5ICkge1xyXG4gICAgICAgICAgJChzZXR0aW5ncy50YXJnZXQpLnN0b3AoKS52ZWxvY2l0eSgnc2Nyb2xsJywge1xyXG4gICAgICAgICAgICBkdXJhdGlvbjogc2V0dGluZ3Muc2Nyb2xsU3BlZWQsXHJcbiAgICAgICAgICAgIGVhc2luZzogc2V0dGluZ3MuZWFzaW5nLFxyXG4gICAgICAgICAgICBvZmZzZXQ6IGRlc3RpbmF0aW9uLFxyXG4gICAgICAgICAgICBtb2JpbGVIQTogZmFsc2VcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAkKHNldHRpbmdzLnRhcmdldCkuc3RvcCgpLmFuaW1hdGUoe1xyXG4gICAgICAgICAgICBzY3JvbGxUb3A6IGRlc3RpbmF0aW9uXHJcbiAgICAgICAgICB9LCBzZXR0aW5ncy5zY3JvbGxTcGVlZCxzZXR0aW5ncy5lYXNpbmcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYod2luZG93LmxvY2F0aW9uLmhhc2gubGVuZ3RoICYmIHNldHRpbmdzLnNlY3Rpb25OYW1lICYmIHdpbmRvdy5jb25zb2xlKSB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZigkKHdpbmRvdy5sb2NhdGlvbi5oYXNoKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJTY3JvbGxpZnkgd2FybmluZzogSUQgbWF0Y2hlcyBoYXNoIHZhbHVlIC0gdGhpcyB3aWxsIGNhdXNlIHRoZSBwYWdlIHRvIGFuY2hvci5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9XHJcbiAgICAgICAgfVxyXG4gICAgICAgICQoc2V0dGluZ3MudGFyZ2V0KS5wcm9taXNlKCkuZG9uZShmdW5jdGlvbigpe1xyXG4gICAgICAgICAgbG9ja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICBmaXJzdExvYWQgPSBmYWxzZTtcclxuICAgICAgICAgIGlmKGNhbGxiYWNrcykge1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5hZnRlcihpbmRleCxlbGVtZW50cyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBpc0FjY2VsZXJhdGluZyhzYW1wbGVzKSB7XHJcbiAgICBmdW5jdGlvbiBhdmVyYWdlKG51bSkge1xyXG4gICAgICB2YXIgc3VtID0gMDtcclxuXHJcbiAgICAgIHZhciBsYXN0RWxlbWVudHMgPSBzYW1wbGVzLnNsaWNlKE1hdGgubWF4KHNhbXBsZXMubGVuZ3RoIC0gbnVtLCAxKSk7XHJcblxyXG4gICAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGFzdEVsZW1lbnRzLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgIHN1bSArPSBsYXN0RWxlbWVudHNbaV07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBNYXRoLmNlaWwoc3VtL251bSk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGF2RW5kID0gYXZlcmFnZSgxMCk7XHJcbiAgICB2YXIgYXZNaWRkbGUgPSBhdmVyYWdlKDcwKTtcclxuXHJcbiAgICBpZihhdkVuZCA+PSBhdk1pZGRsZSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcbiAgdmFyIHNjcm9sbGlmeSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuICAgIGluaXRpYWxpc2VkID0gdHJ1ZTtcclxuICAgICQuZWFzaW5nWydlYXNlT3V0RXhwbyddID0gZnVuY3Rpb24oeCwgdCwgYiwgYywgZCkge1xyXG4gICAgICByZXR1cm4gKHQ9PWQpID8gYitjIDogYyAqICgtTWF0aC5wb3coMiwgLTEwICogdC9kKSArIDEpICsgYjtcclxuICAgIH07XHJcblxyXG4gICAgbWFudWFsU2Nyb2xsID0ge1xyXG4gICAgICBoYW5kbGVNb3VzZWRvd246ZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYoZGlzYWJsZWQ9PT10cnVlKSB7XHJcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2Nyb2xsYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHNjcm9sbGVkID0gZmFsc2U7XHJcbiAgICAgIH0sXHJcbiAgICAgIGhhbmRsZU1vdXNldXA6ZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYoZGlzYWJsZWQ9PT10cnVlKSB7XHJcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2Nyb2xsYWJsZSA9IHRydWU7XHJcbiAgICAgICAgaWYoc2Nyb2xsZWQpIHtcclxuICAgICAgICAgIC8vaW5zdGFudCxjYWxsYmFja3NcclxuICAgICAgICAgIG1hbnVhbFNjcm9sbC5jYWxjdWxhdGVOZWFyZXN0KGZhbHNlLHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgaGFuZGxlU2Nyb2xsOmZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmKGRpc2FibGVkPT09dHJ1ZSkge1xyXG4gICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRpbWVvdXRJZCl7XHJcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHNjcm9sbGVkID0gdHJ1ZTtcclxuICAgICAgICAgIGlmKHNjcm9sbGFibGU9PT1mYWxzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzY3JvbGxhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAvL2luc3RhbnQsY2FsbGJhY2tzXHJcbiAgICAgICAgICBtYW51YWxTY3JvbGwuY2FsY3VsYXRlTmVhcmVzdChmYWxzZSx0cnVlKTtcclxuICAgICAgICB9LCAyMDApO1xyXG4gICAgICB9LFxyXG4gICAgICBjYWxjdWxhdGVOZWFyZXN0OmZ1bmN0aW9uKGluc3RhbnQsY2FsbGJhY2tzKSB7XHJcbiAgICAgICAgdG9wID0gJHdpbmRvdy5zY3JvbGxUb3AoKTtcclxuICAgICAgICB2YXIgaSA9MSxcclxuICAgICAgICAgIG1heCA9IGhlaWdodHMubGVuZ3RoLFxyXG4gICAgICAgICAgY2xvc2VzdCA9IDAsXHJcbiAgICAgICAgICBwcmV2ID0gTWF0aC5hYnMoaGVpZ2h0c1swXSAtIHRvcCksXHJcbiAgICAgICAgICBkaWZmO1xyXG4gICAgICAgIGZvcig7aTxtYXg7aSsrKSB7XHJcbiAgICAgICAgICBkaWZmID0gTWF0aC5hYnMoaGVpZ2h0c1tpXSAtIHRvcCk7XHJcblxyXG4gICAgICAgICAgaWYoZGlmZiA8IHByZXYpIHtcclxuICAgICAgICAgICAgcHJldiA9IGRpZmY7XHJcbiAgICAgICAgICAgIGNsb3Nlc3QgPSBpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZigoYXRCb3R0b20oKSAmJiBjbG9zZXN0PmluZGV4KSB8fCBhdFRvcCgpKSB7XHJcbiAgICAgICAgICBpbmRleCA9IGNsb3Nlc3Q7XHJcbiAgICAgICAgICAvL2luZGV4LCBpbnN0YW50LCBjYWxsYmFja3MsIHRvVG9wXHJcbiAgICAgICAgICBhbmltYXRlU2Nyb2xsKGNsb3Nlc3QsaW5zdGFudCxjYWxsYmFja3MsZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgd2hlZWxIYW5kbGVyOmZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBpZihkaXNhYmxlZD09PXRydWUpIHtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZihzZXR0aW5ncy5zdGFuZGFyZFNjcm9sbEVsZW1lbnRzKSB7XHJcbiAgICAgICAgICBpZigkKGUudGFyZ2V0KS5pcyhzZXR0aW5ncy5zdGFuZGFyZFNjcm9sbEVsZW1lbnRzKSB8fCAkKGUudGFyZ2V0KS5jbG9zZXN0KHNldHRpbmdzLnN0YW5kYXJkU2Nyb2xsRWxlbWVudHMpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIW92ZXJmbG93W2luZGV4XSkge1xyXG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY3VycmVudFNjcm9sbFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuXHJcblxyXG4gICAgICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcclxuICAgICAgICB2YXIgdmFsdWUgPSBlLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSB8fCAtZS5vcmlnaW5hbEV2ZW50LmRlbHRhWSB8fCAtZS5vcmlnaW5hbEV2ZW50LmRldGFpbDtcclxuICAgICAgICB2YXIgZGVsdGEgPSBNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwgdmFsdWUpKTtcclxuXHJcbiAgICAgICAgLy9kZWx0YSA9IGRlbHRhIHx8IC1lLm9yaWdpbmFsRXZlbnQuZGV0YWlsIC8gMyB8fCBlLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSAvIDEyMDtcclxuXHJcbiAgICAgICAgaWYoc2Nyb2xsU2FtcGxlcy5sZW5ndGggPiAxNDkpe1xyXG4gICAgICAgICAgc2Nyb2xsU2FtcGxlcy5zaGlmdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL3Njcm9sbFNhbXBsZXMucHVzaChNYXRoLmFicyhkZWx0YSoxMCkpO1xyXG4gICAgICAgIHNjcm9sbFNhbXBsZXMucHVzaChNYXRoLmFicyh2YWx1ZSkpO1xyXG5cclxuICAgICAgICBpZigoY3VycmVudFNjcm9sbFRpbWUtc2Nyb2xsVGltZSkgPiAyMDApe1xyXG4gICAgICAgICAgc2Nyb2xsU2FtcGxlcyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzY3JvbGxUaW1lID0gY3VycmVudFNjcm9sbFRpbWU7XHJcblxyXG5cclxuICAgICAgICBpZihsb2NrZWQpIHtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoZGVsdGE8MCkge1xyXG4gICAgICAgICAgaWYoaW5kZXg8aGVpZ2h0cy5sZW5ndGgtMSkge1xyXG4gICAgICAgICAgICBpZihhdEJvdHRvbSgpKSB7XHJcbiAgICAgICAgICAgICAgaWYoaXNBY2NlbGVyYXRpbmcoc2Nyb2xsU2FtcGxlcykpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICBsb2NrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy9pbmRleCwgaW5zdGFudCwgY2FsbGJhY2tzLCB0b1RvcFxyXG4gICAgICAgICAgICAgICAgYW5pbWF0ZVNjcm9sbChpbmRleCxmYWxzZSx0cnVlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYoZGVsdGE+MCkge1xyXG4gICAgICAgICAgaWYoaW5kZXg+MCkge1xyXG4gICAgICAgICAgICBpZihhdFRvcCgpKSB7XHJcbiAgICAgICAgICAgICAgaWYoaXNBY2NlbGVyYXRpbmcoc2Nyb2xsU2FtcGxlcykpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIGluZGV4LS07XHJcbiAgICAgICAgICAgICAgICBsb2NrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy9pbmRleCwgaW5zdGFudCwgY2FsbGJhY2tzLCB0b1RvcFxyXG4gICAgICAgICAgICAgICAgYW5pbWF0ZVNjcm9sbChpbmRleCxmYWxzZSx0cnVlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0sXHJcbiAgICAgIGtleUhhbmRsZXI6ZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGlmKGRpc2FibGVkPT09dHJ1ZSB8fCBkb2N1bWVudC5hY3RpdmVFbGVtZW50LnJlYWRPbmx5PT09ZmFsc2UpIHtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihsb2NrZWQ9PT10cnVlKSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGUua2V5Q29kZT09MzggfHwgZS5rZXlDb2RlPT0zMykge1xyXG4gICAgICAgICAgaWYoaW5kZXg+MCkge1xyXG4gICAgICAgICAgICBpZihhdFRvcCgpKSB7XHJcbiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgIGluZGV4LS07XHJcbiAgICAgICAgICAgICAgLy9pbmRleCwgaW5zdGFudCwgY2FsbGJhY2tzLCB0b1RvcFxyXG4gICAgICAgICAgICAgIGFuaW1hdGVTY3JvbGwoaW5kZXgsZmFsc2UsdHJ1ZSxmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYoZS5rZXlDb2RlPT00MCB8fCBlLmtleUNvZGU9PTM0KSB7XHJcbiAgICAgICAgICBpZihpbmRleDxoZWlnaHRzLmxlbmd0aC0xKSB7XHJcbiAgICAgICAgICAgIGlmKGF0Qm90dG9tKCkpIHtcclxuICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAvL2luZGV4LCBpbnN0YW50LCBjYWxsYmFja3MsIHRvVG9wXHJcbiAgICAgICAgICAgICAgYW5pbWF0ZVNjcm9sbChpbmRleCxmYWxzZSx0cnVlLGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgaW5pdDpmdW5jdGlvbigpIHtcclxuICAgICAgICBpZihzZXR0aW5ncy5zY3JvbGxiYXJzKSB7XHJcbiAgICAgICAgICAkd2luZG93Lm9uKCdtb3VzZWRvd24nLCBtYW51YWxTY3JvbGwuaGFuZGxlTW91c2Vkb3duKTtcclxuICAgICAgICAgICR3aW5kb3cub24oJ21vdXNldXAnLCBtYW51YWxTY3JvbGwuaGFuZGxlTW91c2V1cCk7XHJcbiAgICAgICAgICAkd2luZG93Lm9uKCdzY3JvbGwnLCBtYW51YWxTY3JvbGwuaGFuZGxlU2Nyb2xsKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgJChcImJvZHlcIikuY3NzKHtcIm92ZXJmbG93XCI6XCJoaWRkZW5cIn0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAkd2luZG93Lm9uKHdoZWVsRXZlbnQsbWFudWFsU2Nyb2xsLndoZWVsSGFuZGxlcik7XHJcbiAgICAgICAgLy8kKGRvY3VtZW50KS5iaW5kKHdoZWVsRXZlbnQsbWFudWFsU2Nyb2xsLndoZWVsSGFuZGxlcik7XHJcbiAgICAgICAgJHdpbmRvdy5vbigna2V5ZG93bicsIG1hbnVhbFNjcm9sbC5rZXlIYW5kbGVyKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBzd2lwZVNjcm9sbCA9IHtcclxuICAgICAgdG91Y2hlcyA6IHtcclxuICAgICAgICBcInRvdWNoc3RhcnRcIjoge1wieVwiOi0xLFwieFwiOi0xfSxcclxuICAgICAgICBcInRvdWNobW92ZVwiIDoge1wieVwiOi0xLFwieFwiOi0xfSxcclxuICAgICAgICBcInRvdWNoZW5kXCIgIDogZmFsc2UsXHJcbiAgICAgICAgXCJkaXJlY3Rpb25cIiA6IFwidW5kZXRlcm1pbmVkXCJcclxuICAgICAgfSxcclxuICAgICAgb3B0aW9uczp7XHJcbiAgICAgICAgXCJkaXN0YW5jZVwiIDogMzAsXHJcbiAgICAgICAgXCJ0aW1lR2FwXCIgOiA4MDAsXHJcbiAgICAgICAgXCJ0aW1lU3RhbXBcIiA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpXHJcbiAgICAgIH0sXHJcbiAgICAgIHRvdWNoSGFuZGxlcjogZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICBpZihkaXNhYmxlZD09PXRydWUpIHtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZihzZXR0aW5ncy5zdGFuZGFyZFNjcm9sbEVsZW1lbnRzKSB7XHJcbiAgICAgICAgICBpZigkKGV2ZW50LnRhcmdldCkuaXMoc2V0dGluZ3Muc3RhbmRhcmRTY3JvbGxFbGVtZW50cykgfHwgJChldmVudC50YXJnZXQpLmNsb3Nlc3Qoc2V0dGluZ3Muc3RhbmRhcmRTY3JvbGxFbGVtZW50cykubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgdG91Y2g7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBldmVudCAhPT0gJ3VuZGVmaW5lZCcpe1xyXG4gICAgICAgICAgaWYgKHR5cGVvZiBldmVudC50b3VjaGVzICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICB0b3VjaCA9IGV2ZW50LnRvdWNoZXNbMF07XHJcbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xyXG4gICAgICAgICAgICAgIGNhc2UgJ3RvdWNoc3RhcnQnOlxyXG4gICAgICAgICAgICAgICAgc3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaHN0YXJ0LnkgPSB0b3VjaC5wYWdlWTtcclxuICAgICAgICAgICAgICAgIHN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2htb3ZlLnkgPSAtMTtcclxuXHJcbiAgICAgICAgICAgICAgICBzd2lwZVNjcm9sbC50b3VjaGVzLnRvdWNoc3RhcnQueCA9IHRvdWNoLnBhZ2VYO1xyXG4gICAgICAgICAgICAgICAgc3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaG1vdmUueCA9IC0xO1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXBlU2Nyb2xsLm9wdGlvbnMudGltZVN0YW1wID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICBzd2lwZVNjcm9sbC50b3VjaGVzLnRvdWNoZW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgY2FzZSAndG91Y2htb3ZlJzpcclxuICAgICAgICAgICAgICAgIHN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2htb3ZlLnkgPSB0b3VjaC5wYWdlWTtcclxuICAgICAgICAgICAgICAgIHN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2htb3ZlLnggPSB0b3VjaC5wYWdlWDtcclxuICAgICAgICAgICAgICAgIGlmKHN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2hzdGFydC55IT09c3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaG1vdmUueSAmJiAoTWF0aC5hYnMoc3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaHN0YXJ0Lnktc3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaG1vdmUueSk+TWF0aC5hYnMoc3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaHN0YXJ0Lngtc3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaG1vdmUueCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgIC8vaWYoIW92ZXJmbG93W2luZGV4XSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgICBzd2lwZVNjcm9sbC50b3VjaGVzLmRpcmVjdGlvbiA9IFwieVwiO1xyXG4gICAgICAgICAgICAgICAgICBpZigoc3dpcGVTY3JvbGwub3B0aW9ucy50aW1lU3RhbXArc3dpcGVTY3JvbGwub3B0aW9ucy50aW1lR2FwKTwobmV3IERhdGUoKS5nZXRUaW1lKCkpICYmIHN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2hlbmQgPT0gZmFsc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaGVuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2hzdGFydC55ID4gLTEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICBpZihNYXRoLmFicyhzd2lwZVNjcm9sbC50b3VjaGVzLnRvdWNobW92ZS55LXN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2hzdGFydC55KT5zd2lwZVNjcm9sbC5vcHRpb25zLmRpc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2hzdGFydC55IDwgc3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaG1vdmUueSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICBzd2lwZVNjcm9sbC51cCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBzd2lwZVNjcm9sbC5kb3duKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICd0b3VjaGVuZCc6XHJcbiAgICAgICAgICAgICAgICBpZihzd2lwZVNjcm9sbC50b3VjaGVzW2V2ZW50LnR5cGVdPT09ZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgc3dpcGVTY3JvbGwudG91Y2hlc1tldmVudC50eXBlXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChzd2lwZVNjcm9sbC50b3VjaGVzLnRvdWNoc3RhcnQueSA+IC0xICYmIHN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2htb3ZlLnkgPiAtMSAmJiBzd2lwZVNjcm9sbC50b3VjaGVzLmRpcmVjdGlvbj09PVwieVwiKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKE1hdGguYWJzKHN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2htb3ZlLnktc3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaHN0YXJ0LnkpPnN3aXBlU2Nyb2xsLm9wdGlvbnMuZGlzdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGlmKHN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2hzdGFydC55IDwgc3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaG1vdmUueSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2lwZVNjcm9sbC51cCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXBlU2Nyb2xsLmRvd24oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHN3aXBlU2Nyb2xsLnRvdWNoZXMudG91Y2hzdGFydC55ID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpcGVTY3JvbGwudG91Y2hlcy50b3VjaHN0YXJ0LnggPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICBzd2lwZVNjcm9sbC50b3VjaGVzLmRpcmVjdGlvbiA9IFwidW5kZXRlcm1pbmVkXCI7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGRvd246IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICBpZihpbmRleDxoZWlnaHRzLmxlbmd0aCkge1xyXG5cclxuICAgICAgICAgIGlmKGF0Qm90dG9tKCkgJiYgaW5kZXg8aGVpZ2h0cy5sZW5ndGgtMSkge1xyXG5cclxuICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgLy9pbmRleCwgaW5zdGFudCwgY2FsbGJhY2tzLCB0b1RvcFxyXG4gICAgICAgICAgICBhbmltYXRlU2Nyb2xsKGluZGV4LGZhbHNlLHRydWUsZmFsc2UpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcG9ydEhlaWdodCA9IGdldHBvcnRIZWlnaHQoKTtcclxuICAgICAgICAgICAgaWYoTWF0aC5mbG9vcihlbGVtZW50c1tpbmRleF0uaGVpZ2h0KCkvcG9ydEhlaWdodCk+aW50ZXJzdGl0aWFsSW5kZXgpIHtcclxuXHJcbiAgICAgICAgICAgICAgaW50ZXJzdGl0aWFsU2Nyb2xsKHBhcnNlSW50KGhlaWdodHNbaW5kZXhdKSsocG9ydEhlaWdodCppbnRlcnN0aXRpYWxJbmRleCkpO1xyXG4gICAgICAgICAgICAgIGludGVyc3RpdGlhbEluZGV4ICs9IDE7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGludGVyc3RpdGlhbFNjcm9sbChwYXJzZUludChoZWlnaHRzW2luZGV4XSkrKGVsZW1lbnRzW2luZGV4XS5vdXRlckhlaWdodCgpLXBvcnRIZWlnaHQpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHVwOiBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZihpbmRleD49MCkge1xyXG4gICAgICAgICAgaWYoYXRUb3AoKSAmJiBpbmRleD4wKSB7XHJcblxyXG4gICAgICAgICAgICBpbmRleC0tO1xyXG4gICAgICAgICAgICAvL2luZGV4LCBpbnN0YW50LCBjYWxsYmFja3MsIHRvVG9wXHJcbiAgICAgICAgICAgIGFuaW1hdGVTY3JvbGwoaW5kZXgsZmFsc2UsdHJ1ZSxmYWxzZSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgaWYoaW50ZXJzdGl0aWFsSW5kZXg+Mikge1xyXG4gICAgICAgICAgICAgIHBvcnRIZWlnaHQgPSBnZXRwb3J0SGVpZ2h0KCk7XHJcblxyXG4gICAgICAgICAgICAgIGludGVyc3RpdGlhbEluZGV4IC09IDE7XHJcbiAgICAgICAgICAgICAgaW50ZXJzdGl0aWFsU2Nyb2xsKHBhcnNlSW50KGhlaWdodHNbaW5kZXhdKSsocG9ydEhlaWdodCppbnRlcnN0aXRpYWxJbmRleCkpO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgaW50ZXJzdGl0aWFsSW5kZXggPSAxO1xyXG4gICAgICAgICAgICAgIGludGVyc3RpdGlhbFNjcm9sbChwYXJzZUludChoZWlnaHRzW2luZGV4XSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgJiYgc2V0dGluZ3MudG91Y2hTY3JvbGwpIHtcclxuICAgICAgICAgIHZhciBldmVudExpc3RlbmVyT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgcGFzc2l2ZTogZmFsc2VcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgc3dpcGVTY3JvbGwudG91Y2hIYW5kbGVyLCBldmVudExpc3RlbmVyT3B0aW9ucyk7XHJcbiAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBzd2lwZVNjcm9sbC50b3VjaEhhbmRsZXIsIGV2ZW50TGlzdGVuZXJPcHRpb25zKTtcclxuICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgc3dpcGVTY3JvbGwudG91Y2hIYW5kbGVyLCBldmVudExpc3RlbmVyT3B0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICB1dGlsID0ge1xyXG4gICAgICByZWZyZXNoOmZ1bmN0aW9uKHdpdGhDYWxsYmFjayxzY3JvbGwpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkMik7XHJcbiAgICAgICAgdGltZW91dElkMiA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAvL3JldGFpbiBwb3NpdGlvblxyXG4gICAgICAgICAgc2l6ZVBhbmVscyh0cnVlKTtcclxuICAgICAgICAgIC8vc2Nyb2xsLCBmaXJzdExvYWRcclxuICAgICAgICAgIGNhbGN1bGF0ZVBvc2l0aW9ucyhzY3JvbGwsZmFsc2UpO1xyXG4gICAgICAgICAgaWYod2l0aENhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgc2V0dGluZ3MuYWZ0ZXJSZXNpemUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LDQwMCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGhhbmRsZVVwZGF0ZTpmdW5jdGlvbigpIHtcclxuICAgICAgICAvL2NhbGxiYWNrcywgc2Nyb2xsXHJcbiAgICAgICAgLy9jaGFuZ2VkIGZyb20gZmFsc2UsdHJ1ZSB0byBmYWxzZSxmYWxzZVxyXG4gICAgICAgIHV0aWwucmVmcmVzaChmYWxzZSxmYWxzZSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGhhbmRsZVJlc2l6ZTpmdW5jdGlvbigpIHtcclxuICAgICAgICAvL2NhbGxiYWNrcywgc2Nyb2xsXHJcbiAgICAgICAgdXRpbC5yZWZyZXNoKHRydWUsZmFsc2UpO1xyXG4gICAgICB9LFxyXG4gICAgICBoYW5kbGVPcmllbnRhdGlvbjpmdW5jdGlvbigpIHtcclxuICAgICAgICAvL2NhbGxiYWNrcywgc2Nyb2xsXHJcbiAgICAgICAgdXRpbC5yZWZyZXNoKHRydWUsdHJ1ZSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBzZXR0aW5ncyA9ICQuZXh0ZW5kKHNldHRpbmdzLCBvcHRpb25zKTtcclxuXHJcbiAgICAvL3JldGFpbiBwb3NpdGlvblxyXG4gICAgc2l6ZVBhbmVscyhmYWxzZSk7XHJcblxyXG4gICAgY2FsY3VsYXRlUG9zaXRpb25zKGZhbHNlLHRydWUpO1xyXG5cclxuICAgIGlmKHRydWU9PT1oYXNMb2NhdGlvbikge1xyXG4gICAgICAvL2luZGV4LCBpbnN0YW50LCBjYWxsYmFja3MsIHRvVG9wXHJcbiAgICAgIGFuaW1hdGVTY3JvbGwoaW5kZXgsZmFsc2UsdHJ1ZSx0cnVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy9pbnN0YW50LGNhbGxiYWNrc1xyXG4gICAgICAgIG1hbnVhbFNjcm9sbC5jYWxjdWxhdGVOZWFyZXN0KHRydWUsZmFsc2UpO1xyXG4gICAgICB9LDIwMCk7XHJcbiAgICB9XHJcbiAgICBpZihoZWlnaHRzLmxlbmd0aCkge1xyXG4gICAgICBtYW51YWxTY3JvbGwuaW5pdCgpO1xyXG4gICAgICBzd2lwZVNjcm9sbC5pbml0KCk7XHJcblxyXG4gICAgICAkd2luZG93Lm9uKFwicmVzaXplXCIsdXRpbC5oYW5kbGVSZXNpemUpO1xyXG4gICAgICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikge1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwib3JpZW50YXRpb25jaGFuZ2VcIiwgdXRpbC5oYW5kbGVPcmllbnRhdGlvbiwgZmFsc2UpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBpbnRlcnN0aXRpYWxTY3JvbGwocG9zKSB7XHJcbiAgICAgIGlmKCAkKCkudmVsb2NpdHkgKSB7XHJcbiAgICAgICAgJChzZXR0aW5ncy50YXJnZXQpLnN0b3AoKS52ZWxvY2l0eSgnc2Nyb2xsJywge1xyXG4gICAgICAgICAgZHVyYXRpb246IHNldHRpbmdzLnNjcm9sbFNwZWVkLFxyXG4gICAgICAgICAgZWFzaW5nOiBzZXR0aW5ncy5lYXNpbmcsXHJcbiAgICAgICAgICBvZmZzZXQ6IHBvcyxcclxuICAgICAgICAgIG1vYmlsZUhBOiBmYWxzZVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICQoc2V0dGluZ3MudGFyZ2V0KS5zdG9wKCkuYW5pbWF0ZSh7XHJcbiAgICAgICAgICBzY3JvbGxUb3A6IHBvc1xyXG4gICAgICAgIH0sIHNldHRpbmdzLnNjcm9sbFNwZWVkLHNldHRpbmdzLmVhc2luZyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBzaXplUGFuZWxzKGtlZXBQb3NpdGlvbikge1xyXG4gICAgICBpZihrZWVwUG9zaXRpb24pIHtcclxuICAgICAgICB0b3AgPSAkd2luZG93LnNjcm9sbFRvcCgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2YXIgc2VsZWN0b3IgPSBzZXR0aW5ncy5zZWN0aW9uO1xyXG4gICAgICBvdmVyZmxvdyA9IFtdO1xyXG4gICAgICBpZihzZXR0aW5ncy5pbnRlcnN0aXRpYWxTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgIHNlbGVjdG9yICs9IFwiLFwiICsgc2V0dGluZ3MuaW50ZXJzdGl0aWFsU2VjdGlvbjtcclxuICAgICAgfVxyXG4gICAgICBpZihzZXR0aW5ncy5zY3JvbGxiYXJzPT09ZmFsc2UpIHtcclxuICAgICAgICBzZXR0aW5ncy5vdmVyZmxvd1Njcm9sbCA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIHBvcnRIZWlnaHQgPSBnZXRwb3J0SGVpZ2h0KCk7XHJcbiAgICAgICQoc2VsZWN0b3IpLmVhY2goZnVuY3Rpb24oaSkge1xyXG4gICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XHJcblxyXG4gICAgICAgIGlmKHNldHRpbmdzLnNldEhlaWdodHMpIHtcclxuICAgICAgICAgIGlmKCR0aGlzLmlzKHNldHRpbmdzLmludGVyc3RpdGlhbFNlY3Rpb24pKSB7XHJcbiAgICAgICAgICAgIG92ZXJmbG93W2ldID0gZmFsc2U7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZigoJHRoaXMuY3NzKFwiaGVpZ2h0XCIsXCJhdXRvXCIpLm91dGVySGVpZ2h0KCk8cG9ydEhlaWdodCkgfHwgJHRoaXMuY3NzKFwib3ZlcmZsb3dcIik9PT1cImhpZGRlblwiKSB7XHJcbiAgICAgICAgICAgICAgJHRoaXMuY3NzKHtcImhlaWdodFwiOnBvcnRIZWlnaHR9KTtcclxuXHJcbiAgICAgICAgICAgICAgb3ZlcmZsb3dbaV0gPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgJHRoaXMuY3NzKHtcImhlaWdodFwiOiR0aGlzLmhlaWdodCgpfSk7XHJcblxyXG4gICAgICAgICAgICAgIGlmKHNldHRpbmdzLm92ZXJmbG93U2Nyb2xsKSB7XHJcbiAgICAgICAgICAgICAgICBvdmVyZmxvd1tpXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG92ZXJmbG93W2ldID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgIGlmKCgkdGhpcy5vdXRlckhlaWdodCgpPHBvcnRIZWlnaHQpIHx8IChzZXR0aW5ncy5vdmVyZmxvd1Njcm9sbD09PWZhbHNlKSkge1xyXG4gICAgICAgICAgICBvdmVyZmxvd1tpXSA9IGZhbHNlO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3ZlcmZsb3dbaV0gPSB0cnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIGlmKGtlZXBQb3NpdGlvbikge1xyXG4gICAgICAgICR3aW5kb3cuc2Nyb2xsVG9wKHRvcCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVBvc2l0aW9ucyhzY3JvbGwsZmlyc3RMb2FkKSB7XHJcbiAgICAgIHZhciBzZWxlY3RvciA9IHNldHRpbmdzLnNlY3Rpb247XHJcbiAgICAgIGlmKHNldHRpbmdzLmludGVyc3RpdGlhbFNlY3Rpb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgc2VsZWN0b3IgKz0gXCIsXCIgKyBzZXR0aW5ncy5pbnRlcnN0aXRpYWxTZWN0aW9uO1xyXG4gICAgICB9XHJcbiAgICAgIGhlaWdodHMgPSBbXTtcclxuICAgICAgbmFtZXMgPSBbXTtcclxuICAgICAgZWxlbWVudHMgPSBbXTtcclxuICAgICAgJChzZWxlY3RvcikuZWFjaChmdW5jdGlvbihpKXtcclxuICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XHJcbiAgICAgICAgICBpZihpPjApIHtcclxuICAgICAgICAgICAgaGVpZ2h0c1tpXSA9IHBhcnNlSW50KCR0aGlzLm9mZnNldCgpLnRvcCkgKyBzZXR0aW5ncy5vZmZzZXQ7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBoZWlnaHRzW2ldID0gcGFyc2VJbnQoJHRoaXMub2Zmc2V0KCkudG9wKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmKHNldHRpbmdzLnNlY3Rpb25OYW1lICYmICR0aGlzLmRhdGEoc2V0dGluZ3Muc2VjdGlvbk5hbWUpKSB7XHJcbiAgICAgICAgICAgIG5hbWVzW2ldID0gXCIjXCIgKyAkdGhpcy5kYXRhKHNldHRpbmdzLnNlY3Rpb25OYW1lKS50b1N0cmluZygpLnJlcGxhY2UoLyAvZyxcIi1cIik7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZigkdGhpcy5pcyhzZXR0aW5ncy5pbnRlcnN0aXRpYWxTZWN0aW9uKT09PWZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgbmFtZXNbaV0gPSBcIiNcIiArIChpICsgMSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgbmFtZXNbaV0gPSBcIiNcIjtcclxuICAgICAgICAgICAgICBpZihpPT09JChzZWxlY3RvcikubGVuZ3RoLTEgJiYgaT4xKSB7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHRzW2ldID0gaGVpZ2h0c1tpLTFdICsgKHBhcnNlSW50KCQoJChzZWxlY3RvcilbaS0xXSkub3V0ZXJIZWlnaHQoKSkgLSBwYXJzZUludCgkKHdpbmRvdykuaGVpZ2h0KCkpKSArIHBhcnNlSW50KCR0aGlzLm91dGVySGVpZ2h0KCkpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxlbWVudHNbaV0gPSAkdGhpcztcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmKCQobmFtZXNbaV0pLmxlbmd0aCAmJiB3aW5kb3cuY29uc29sZSkge1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIlNjcm9sbGlmeSB3YXJuaW5nOiBTZWN0aW9uIG5hbWVzIGNhbid0IG1hdGNoIElEcyAtIHRoaXMgd2lsbCBjYXVzZSB0aGUgYnJvd3NlciB0byBhbmNob3IuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGNhdGNoIChlKSB7fVxyXG5cclxuICAgICAgICAgIGlmKHdpbmRvdy5sb2NhdGlvbi5oYXNoPT09bmFtZXNbaV0pIHtcclxuICAgICAgICAgICAgaW5kZXggPSBpO1xyXG4gICAgICAgICAgICBoYXNMb2NhdGlvbiA9IHRydWU7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmKHRydWU9PT1zY3JvbGwpIHtcclxuICAgICAgICAvL2luZGV4LCBpbnN0YW50LCBjYWxsYmFja3MsIHRvVG9wXHJcbiAgICAgICAgYW5pbWF0ZVNjcm9sbChpbmRleCxmYWxzZSxmYWxzZSxmYWxzZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBhdFRvcCgpIHtcclxuICAgICAgaWYoIW92ZXJmbG93W2luZGV4XSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIHRvcCA9ICR3aW5kb3cuc2Nyb2xsVG9wKCk7XHJcbiAgICAgIGlmKHRvcD5wYXJzZUludChoZWlnaHRzW2luZGV4XSkpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGF0Qm90dG9tKCkge1xyXG4gICAgICBpZighb3ZlcmZsb3dbaW5kZXhdKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgdG9wID0gJHdpbmRvdy5zY3JvbGxUb3AoKTtcclxuICAgICAgcG9ydEhlaWdodCA9IGdldHBvcnRIZWlnaHQoKTtcclxuXHJcbiAgICAgIGlmKHRvcDxwYXJzZUludChoZWlnaHRzW2luZGV4XSkrKGVsZW1lbnRzW2luZGV4XS5vdXRlckhlaWdodCgpLXBvcnRIZWlnaHQpLTI4KSB7XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG1vdmUocGFuZWwsaW5zdGFudCkge1xyXG4gICAgdmFyIHogPSBuYW1lcy5sZW5ndGg7XHJcbiAgICBmb3IoO3o+PTA7ei0tKSB7XHJcbiAgICAgIGlmKHR5cGVvZiBwYW5lbCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICBpZiAobmFtZXNbel09PT1wYW5lbCkge1xyXG4gICAgICAgICAgaW5kZXggPSB6O1xyXG4gICAgICAgICAgLy9pbmRleCwgaW5zdGFudCwgY2FsbGJhY2tzLCB0b1RvcFxyXG4gICAgICAgICAgYW5pbWF0ZVNjcm9sbCh6LGluc3RhbnQsdHJ1ZSx0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYoej09PXBhbmVsKSB7XHJcbiAgICAgICAgICBpbmRleCA9IHo7XHJcbiAgICAgICAgICAvL2luZGV4LCBpbnN0YW50LCBjYWxsYmFja3MsIHRvVG9wXHJcbiAgICAgICAgICBhbmltYXRlU2Nyb2xsKHosaW5zdGFudCx0cnVlLHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBzY3JvbGxpZnkubW92ZSA9IGZ1bmN0aW9uKHBhbmVsKSB7XHJcbiAgICBpZihwYW5lbD09PXVuZGVmaW5lZCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZihwYW5lbC5vcmlnaW5hbEV2ZW50KSB7XHJcbiAgICAgIHBhbmVsID0gJCh0aGlzKS5hdHRyKFwiaHJlZlwiKTtcclxuICAgIH1cclxuICAgIG1vdmUocGFuZWwsZmFsc2UpO1xyXG4gIH07XHJcbiAgc2Nyb2xsaWZ5Lmluc3RhbnRNb3ZlID0gZnVuY3Rpb24ocGFuZWwpIHtcclxuICAgIGlmKHBhbmVsPT09dW5kZWZpbmVkKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIG1vdmUocGFuZWwsdHJ1ZSk7XHJcbiAgfTtcclxuICBzY3JvbGxpZnkubmV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgaWYoaW5kZXg8bmFtZXMubGVuZ3RoKSB7XHJcbiAgICAgIGluZGV4ICs9IDE7XHJcbiAgICAgIC8vaW5kZXgsIGluc3RhbnQsIGNhbGxiYWNrcywgdG9Ub3BcclxuICAgICAgYW5pbWF0ZVNjcm9sbChpbmRleCxmYWxzZSx0cnVlLHRydWUpO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgc2Nyb2xsaWZ5LnByZXZpb3VzID0gZnVuY3Rpb24oKSB7XHJcbiAgICBpZihpbmRleD4wKSB7XHJcbiAgICAgIGluZGV4IC09IDE7XHJcbiAgICAgIC8vaW5kZXgsIGluc3RhbnQsIGNhbGxiYWNrcywgdG9Ub3BcclxuICAgICAgYW5pbWF0ZVNjcm9sbChpbmRleCxmYWxzZSx0cnVlLHRydWUpO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgc2Nyb2xsaWZ5Lmluc3RhbnROZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICBpZihpbmRleDxuYW1lcy5sZW5ndGgpIHtcclxuICAgICAgaW5kZXggKz0gMTtcclxuICAgICAgLy9pbmRleCwgaW5zdGFudCwgY2FsbGJhY2tzLCB0b1RvcFxyXG4gICAgICBhbmltYXRlU2Nyb2xsKGluZGV4LHRydWUsdHJ1ZSx0cnVlKTtcclxuICAgIH1cclxuICB9O1xyXG4gIHNjcm9sbGlmeS5pbnN0YW50UHJldmlvdXMgPSBmdW5jdGlvbigpIHtcclxuICAgIGlmKGluZGV4PjApIHtcclxuICAgICAgaW5kZXggLT0gMTtcclxuICAgICAgLy9pbmRleCwgaW5zdGFudCwgY2FsbGJhY2tzLCB0b1RvcFxyXG4gICAgICBhbmltYXRlU2Nyb2xsKGluZGV4LHRydWUsdHJ1ZSx0cnVlKTtcclxuICAgIH1cclxuICB9O1xyXG4gIHNjcm9sbGlmeS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XHJcbiAgICBpZighaW5pdGlhbGlzZWQpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYoc2V0dGluZ3Muc2V0SGVpZ2h0cykge1xyXG4gICAgICAkKHNldHRpbmdzLnNlY3Rpb24pLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJCh0aGlzKS5jc3MoXCJoZWlnaHRcIixcImF1dG9cIik7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgJHdpbmRvdy5vZmYoXCJyZXNpemVcIix1dGlsLmhhbmRsZVJlc2l6ZSk7XHJcbiAgICBpZihzZXR0aW5ncy5zY3JvbGxiYXJzKSB7XHJcbiAgICAgICR3aW5kb3cub2ZmKCdtb3VzZWRvd24nLCBtYW51YWxTY3JvbGwuaGFuZGxlTW91c2Vkb3duKTtcclxuICAgICAgJHdpbmRvdy5vZmYoJ21vdXNldXAnLCBtYW51YWxTY3JvbGwuaGFuZGxlTW91c2V1cCk7XHJcbiAgICAgICR3aW5kb3cub2ZmKCdzY3JvbGwnLCBtYW51YWxTY3JvbGwuaGFuZGxlU2Nyb2xsKTtcclxuICAgIH1cclxuICAgICR3aW5kb3cub2ZmKHdoZWVsRXZlbnQsbWFudWFsU2Nyb2xsLndoZWVsSGFuZGxlcik7XHJcbiAgICAkd2luZG93Lm9mZigna2V5ZG93bicsIG1hbnVhbFNjcm9sbC5rZXlIYW5kbGVyKTtcclxuXHJcbiAgICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAmJiBzZXR0aW5ncy50b3VjaFNjcm9sbCkge1xyXG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgc3dpcGVTY3JvbGwudG91Y2hIYW5kbGVyLCBmYWxzZSk7XHJcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHN3aXBlU2Nyb2xsLnRvdWNoSGFuZGxlciwgZmFsc2UpO1xyXG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHN3aXBlU2Nyb2xsLnRvdWNoSGFuZGxlciwgZmFsc2UpO1xyXG4gICAgfVxyXG4gICAgaGVpZ2h0cyA9IFtdO1xyXG4gICAgbmFtZXMgPSBbXTtcclxuICAgIGVsZW1lbnRzID0gW107XHJcbiAgICBvdmVyZmxvdyA9IFtdO1xyXG4gIH07XHJcbiAgc2Nyb2xsaWZ5LnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgaWYoIWluaXRpYWxpc2VkKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHV0aWwuaGFuZGxlVXBkYXRlKCk7XHJcbiAgfTtcclxuICBzY3JvbGxpZnkuY3VycmVudCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIGVsZW1lbnRzW2luZGV4XTtcclxuICB9O1xyXG4gIHNjcm9sbGlmeS5jdXJyZW50SW5kZXggPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBpbmRleDtcclxuICB9O1xyXG4gIHNjcm9sbGlmeS5kaXNhYmxlID0gZnVuY3Rpb24oKSB7XHJcbiAgICBkaXNhYmxlZCA9IHRydWU7XHJcbiAgfTtcclxuICBzY3JvbGxpZnkuZW5hYmxlID0gZnVuY3Rpb24oKSB7XHJcbiAgICBkaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgaWYgKGluaXRpYWxpc2VkKSB7XHJcbiAgICAgIC8vaW5zdGFudCxjYWxsYmFja3NcclxuICAgICAgbWFudWFsU2Nyb2xsLmNhbGN1bGF0ZU5lYXJlc3QoZmFsc2UsZmFsc2UpO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgc2Nyb2xsaWZ5LmlzRGlzYWJsZWQgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBkaXNhYmxlZDtcclxuICB9O1xyXG4gIHNjcm9sbGlmeS5zZXRPcHRpb25zID0gZnVuY3Rpb24odXBkYXRlZE9wdGlvbnMpIHtcclxuICAgIGlmKCFpbml0aWFsaXNlZCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZih0eXBlb2YgdXBkYXRlZE9wdGlvbnMgPT09IFwib2JqZWN0XCIpIHtcclxuICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZChzZXR0aW5ncywgdXBkYXRlZE9wdGlvbnMpO1xyXG4gICAgICB1dGlsLmhhbmRsZVVwZGF0ZSgpO1xyXG4gICAgfSBlbHNlIGlmKHdpbmRvdy5jb25zb2xlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihcIlNjcm9sbGlmeSB3YXJuaW5nOiBzZXRPcHRpb25zIGV4cGVjdHMgYW4gb2JqZWN0LlwiKTtcclxuICAgIH1cclxuICB9O1xyXG4gICQuc2Nyb2xsaWZ5ID0gc2Nyb2xsaWZ5O1xyXG4gIHJldHVybiBzY3JvbGxpZnk7XHJcbn0pKTtcclxuIl19
